<script lang="ts" setup>
import Github from '@/assets/svg/Github.svg';
import cola from '@/assets/img/aside/cola.png';
import banana from '@/assets/img/aside/banana.png';
import microwave from '@/assets/img/aside/microwave.png';
import back from '@/assets/img/aside/back.png';
import Wupa from '@/assets/img/aside/Wupa.png';
import Setting from '@/components/Aside/setting.vue';
import backyes from '@/assets/img/aside/backyes.png';
import { useMusicInfoStore } from '@/stores/MusicInfo';
import { useStatusInfo } from '@/stores/StatusInfo';
import chatHistory from '@/components/Aside/chatHistory.vue';
import About from '@/components/Aside/About.vue';
const musicInfoStore = useMusicInfoStore();
const StatusInfo = useStatusInfo();
import { computed, onBeforeMount, onMounted, onUnmounted, ref, watch } from 'vue';
import router from '@/router';
// import { useRoute } from 'vue-router';


const drawer = ref(false);
const drawer2 = ref(false);
const drawer3 = ref(false);
const showPre = ref(false);
const showPre1 = ref(false);
const showPre2 = ref(false);
const showPre3 = ref(false);
const showDiv1 = ref(true);
const showDiv2 = ref(false);
const showPage1 = ref(true);
const showPage2 = ref(false);
const showPage3 = ref(false);
const isLeaving = ref(false);
const centerDialogVisible = ref(false)
const centerDialogVisible2 = ref(false)


const currentTab = ref('playlist');  // é»˜è®¤é€‰ä¸­çš„æ ‡ç­¾


const setActive = (tab: any) => {
    currentTab.value = tab;
};
const showlist = () => {
    showDiv1.value = true;
    showDiv2.value = false; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2
};
const fun_showPage1 = () => {
    showPage1.value = true;
    showPage2.value = false; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2
    showPage3.value = false; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2

};
const fun_showPage2 = () => {
    showPage1.value = false;
    showPage3.value = false; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2
    showPage2.value = true; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2

};
const fun_showPage3 = () => {
    showPage1.value = false;
    showPage3.value = true; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2
    showPage2.value = false; // ç‚¹å‡»å±•ç¤º1åï¼Œéšè—å±•ç¤º2

};
const showadd = () => {
    showDiv2.value = true;
    showDiv1.value = false; // ç‚¹å‡»å±•ç¤º2åï¼Œéšè—å±•ç¤º1
};

const AboutMe = () => {

}
const handleClose = (done: () => void) => {
    done()
}
const formatDuration = (milliseconds: any) => {
    const totalSeconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = (totalSeconds % 60).toString().padStart(2, '0');
    return `${minutes}:${seconds}`;
}
</script>

<template>

    <el-dialog style="border-radius: 1.1em;margin-top:8em; width: 30em;min-height: 23em;--color: rgba(114, 114, 114, 0.3);
  background-color: #f2f3f2;
  background-image: linear-gradient(0deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent),
      linear-gradient(90deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent);
  background-size: 55px 55px;" v-model="centerDialogVisible2" center title="" align-center>

        <template #header style="display: inline-block;">
            <div>
                <Transition name="fade2">
                    <h2 style="color: #333;" v-if="showPage1">å…³äºæœ¬ç«™</h2>
                </Transition>
                <Transition name="fade2">
                    <h2 style="color: #333;" v-if="showPage2">å…³äºä½œè€…</h2>
                </Transition>
                <Transition name="fade2">
                    <h2 style="color: #333;" v-if="showPage3">å¸¸è§é—®é¢˜</h2>
                </Transition>

            </div>

        </template>

        <div v-if="showPage1" style="color: #333;font-size: 1.2em;line-height: 1.8;padding: 0 1em;">
            <p>å‘¼å“ˆå“ˆå“ˆå“ˆå“ˆï¼Œæˆ‘æ˜¯Dripï¼Œåœ¨ä»‹ç»æœ¬ç«™å‰å…ˆç”±è¡·æ„Ÿè°¢BlackCarDriverå¯¹æ­¤ç«™ç•Œé¢UIæä¾›å’ŒæŠ€æœ¯æ”¯æŒã€‚ </p>
            <p><strong
                    style="color: #df6973;">ä¸ºä»€ä¹ˆä¼šæœ‰æ­¤ç«™ï¼Ÿ</strong>æœ€åˆæ˜¯æœ¬äººåœ¨æ— èŠä¹‹æ—¶å¶ç„¶å‘ç°ä¸€ä¸ªæå…·ç‰¹è‰²çš„ä¸€ä¸ªç½‘ç«™ï¼Œä¸»é¢˜å’Œé£æ ¼éƒ½ç‰¹åˆ«è®¨å–œï¼Œäºæ˜¯æˆ‘å°±æƒ³ç€èƒ½ä¸èƒ½åšä¸€ä¸ª<strong>ã€Šå‘½è¿çŸ³ä¹‹é—¨ã€‹</strong>ä¸»é¢˜çš„ã€‚è¯´å¹²å°±å¹²ï¼å°±å¼€å§‹æ…¢æ…¢å†™äº†~
            </p>
            <p>ç›®å‰æœ¬ç«™ä»åœ¨å®Œå–„ä¸­,å¦‚æœæœ‰å¥‡å¥‡æ€ªæ€ªçš„bugæˆ–å»ºè®®ï¼Œéƒ½æ¬¢è¿å¤§å®¶å‘æˆ‘æä¾›å®Œå–„å»ºè®®ï½</p>

            <strong style="color: #df6973;">æ¬¢è¿åŠ å…¥å¤§å®¶åº­ï¼š</strong>
            <span> Labmemã®ç§˜å¯†åŸºåœ°ï¼šQç¾¤-- <span style=" cursor: pointer;color:
                #cb819f;">335463956</span></span>
        </div>

        <div v-if="showPage2" style="color: #333;font-size: 1.2em;line-height: 1.8;padding: 0 1em;">
            <div style="display: flex; flex-direction: column; align-items: center;transform: translateX(-.8em);">
                <el-avatar style="width: 8em;height: 8em;  border: .1em solid white; "
                    src=" https://pic.imgdb.cn/item/66bb1bf0d9c307b7e9b2b2d8.jpg"></el-avatar>
                <div class="avatarBoxNick avatarSmall">Drip </div>
                <div style="font-size: .9em;margin-top: 1em;text-align: center">
                    é‚®ç®±åœ°å€ï¼š<a style="color: palevioletred;" href="mailto:drippp0127@gmail.com">drippp0127@gmail.com</a>
                    <p>Github: <a style="color: palevioletred;"
                            href="https://github.com/LittleDrip/Steins-Gate-Room/">Steins-Gate-Room</a>
                    </p>
                    <p style="margin-top: 1em;">
                        å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æœ¬ç«™çš„ä½œè€…Dripï¼Œæ¬¢è¿å¤§å®¶æ¥åˆ°çŸ³å¤´é—¨èŠå¤©å®¤ã€‚æ¬¢è¿å¤§å®¶äº¤æµå„ç§é—®é¢˜ï¼Œä¼˜åŒ–å»ºè®®ã€‚å¤§å®¶å¯ä»¥è®¨è®ºä¸€åˆ‡ä½ æ„Ÿå…´è¶£çš„è¯é¢˜ã€‚

                        å¦‚æœä½ æœ‰ä»»ä½•æƒ³æ³•æˆ–åé¦ˆï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šå°½åŠ›ä¸æ–­æ”¹è¿›è¿™ä¸ªç½‘ç«™ï¼Œæå‡å¤§å®¶çš„ä½“éªŒã€‚</p>
                </div>
            </div>
        </div>
        <div v-if="showPage3" style="color: #333;font-size: 1.2em;line-height: 1.8;padding: 0 1em;">
            <strong style="color: #df6973;">1. æ‰‹æœºç‰ˆæ”¯æŒé—®é¢˜</strong>
            <p style="color:gray;">ç›®å‰å¯¹éƒ¨åˆ†æœºå‹å’Œæµè§ˆå™¨çš„æ ·å¼å’ŒåŠŸèƒ½æ”¯æŒä¸å¤ªå®Œå–„ï¼Œå¦‚éƒ¨åˆ†æœºå‹åªèƒ½ä½¿ç”¨ç³»ç»ŸéŸ³é‡æ¥è°ƒèŠ‚å¤§å°,å¦‚æœæœ‰èƒ½åŠ›ï¼Œå»ºè®®å¤§å®¶å°½å¯èƒ½ä½¿ç”¨ç”µè„‘æµè§ˆã€‚</p>
            <br>
            <strong style="color: #df6973;">2. ç½‘é¡µå¡é¡¿/åŠ è½½æ…¢ï¼Ÿ</strong>
            <p style="color:gray">æ”¾å¿ƒï¼Œä¸æ˜¯ä½ ä»¬çš„é—®é¢˜ã€‚æ˜¯ä½œè€…çš„è·åŒ…æœ‰é™ï¼Œä¹°çš„æœåŠ¡å™¨å¾ˆçƒ‚ï¼Œå¤§å®¶ä¸è¦ç”Ÿæ°”ï¼Œå¦‚æœæœ¬ç«™äººå¤šçš„è¯ä¼šè€ƒè™‘å‡çº§é…ç½®çš„ã€‚æœ€åï¼ŒEl Psy Kongroo~</p>


        </div>


        <template #footer>
            <div>
                <!-- â† â†’-->
                <div style="text-align: right;display: block;">
                    <span v-if="showPage1" style="font-size: 5em;cursor: pointer;" @click="fun_showPage2()">â†’</span>
                </div>
                <div style="display: flex; justify-content: space-between">
                    <span v-if="showPage2" style="font-size: 5em;cursor: pointer;" @click="fun_showPage1()">â†</span>
                    <span v-if="showPage2" style="font-size: 5em;cursor: pointer;" @click="fun_showPage3()">â†’</span>
                </div>

                <span v-if="showPage3" style="font-size: 5em;cursor: pointer;" @click="fun_showPage2()">â†</span>

            </div>
        </template>

    </el-dialog>



    <div style="position: fixed;">
        <img class="backImg" @click="centerDialogVisible = true" :src="back"
            style="width: 6.5em;margin-top: 0.5em;margin-left: 0.2em;cursor: pointer; ">
    </div>
    <div>
        <el-dialog style="margin-top: 15em; width: 25em;;--color: rgba(114, 114, 114, 0.3);
  background-color: #f2f3f2;
  background-image: linear-gradient(0deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent),
      linear-gradient(90deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent);
  background-size: 55px 55px;" v-model="centerDialogVisible" center title="" width="415" align-center>
            <template #header style="display: inline-block;">

                <img style="width: 10em;margin-left: 0em;" :src="backyes">
            </template>
            <template #footer>
                <div class="dialog-footer">
                    <button @click="centerDialogVisible = false; isLeaving = true; router.push('/hall')">ç¡®è®¤</button>
                    <button style="background: #93cefa;"
                        @click=" isLeaving = false; centerDialogVisible = false">ç®—äº†</button>
                </div>
            </template>
        </el-dialog>
    </div>

    <div class="all">
        <div class="fakeCircle"></div>
        <el-image class="cola" @dragstart.prevent :src="cola" fit="cover" style="width: 2.6em; cursor: pointer;"
            @mouseover="showPre = true" @mouseleave="showPre = false" @click=" drawer = true"></el-image>
        <div class="fakeCircle1"></div>

        <el-image @dragstart.prevent :src="banana" fit="cover" style="width: 5em; margin-top: 1em; cursor: pointer;"
            @mouseover="showPre1 = true" @mouseleave="showPre1 = false" @click="drawer2 = true"></el-image>
        <div class="fakeCircle2"></div>

        <el-image @dragstart.prevent :src="Wupa" fit="cover" style="width: 3em; margin-top: 1em; cursor: pointer;"
            @mouseover="showPre2 = true" @mouseleave="showPre2 = false" @click="drawer3 = true"></el-image>
        <div class="fakeCircle3"></div>

        <el-image @dragstart.prevent :src="microwave" fit="cover" style="width: 6em;;margin-top: 1em;  cursor: pointer;"
            @mouseover="showPre3 = true" @mouseleave=" showPre3 = false"
            @click="centerDialogVisible2 = true"></el-image>

    </div>
    <div class="showTag">
        <transition name="fade">
            <div v-if="showPre == true" class="list">æ’­æ”¾åˆ—è¡¨</div>
        </transition>
        <transition name="fade">
            <div v-if="showPre1 == true" class="setting">è®¾ç½®</div>
        </transition>
        <transition name="fade">
            <div v-if="showPre2 == true" class="chathistory">èŠå¤©è®°å½•</div>
        </transition>
        <transition name="fade">
            <div v-if="showPre3 == true" class="about">å…³äº</div>
        </transition>
    </div>

    <div class="drawer ScrollDiv">

        <el-drawer v-model="drawer" :with-header="false" direction="rtl" :before-close="handleClose" :size="0">
            <div style="display: flex; text-align: center; font-weight: 600;">
                <div :class="{ active: currentTab === 'playlist' }" @click="showlist(); setActive('playlist')"
                    style="width: 12.5em;">
                    <span :class="{ 'active-border': currentTab === 'playlist' }"
                        style="font-size: 1.25em; color: #666;">æ’­æ”¾åˆ—è¡¨</span>
                </div>
                <div :class="{ active: currentTab === 'addsong' }" @click="showadd(); setActive('addsong')"
                    style=" margin-left: 1.25em; width: 12.5em;">
                    <span :class="{ 'active-border': currentTab === 'addsong' }"
                        style="font-size: 1.25em; color: #666;">æ·»åŠ æ­Œæ›²</span>
                </div>
            </div>
            <div v-if="showDiv1" style="margin-top: 1.5em;">
                <div class=" music-item " v-for="(item, index) in musicInfoStore.ListInfo" :key="index"
                    style="margin-top: 0.75em;" :class="{ 'highlight': index === StatusInfo.currentSongIndex }">
                    <el-container @click="StatusInfo.setSongIndex(index); StatusInfo.changeSongIndex()"
                        style="height: 6.25em;width: auto;cursor: pointer;">
                        <el-aside width="6.875em" style="overflow: hidden;">
                            <img :src="item.picUrl" class="coverImg" loading="lazy"></img>
                        </el-aside>
                        <el-main style="overflow: hidden;">
                            <div class="main">
                                <div class="headTitle">{{ item.name }}</div>
                                <div class="content">
                                    <p>{{ item.author }}</p>
                                    <p style="margin: 1em 0 0 16em">{{ formatDuration(item.time) }}</p>
                                </div>
                            </div>
                        </el-main>
                    </el-container>
                </div>
            </div>
            <div v-if="showDiv2">
                <div style="text-align: center;line-height: 2em;margin-top: 2em">
                    <h2>æ­¤åŠŸèƒ½å¾…å¼€å‘</h2>
                    <span>è¯·ç­‰å¾…æ›´æ–°ğŸ¥</span>
                </div>

            </div>

        </el-drawer>

        <!-- ---------------------------drawer2---------------- -->
        <el-drawer v-model="drawer2" :with-header="false" direction="rtl" :before-close="handleClose" :size="0">
            <Setting />
        </el-drawer>
        <!-- ---------------------------drawer2---------------- -->

        <el-drawer style=" background-color: #f0f0f0; " v-model="drawer3" :with-header="false" direction="ltr"
            :before-close="handleClose" :size="0">
            <chatHistory />
        </el-drawer>
    </div>
</template>

<style scoped>
.fakeCircle {
    width: 3.5em;
    height: 3.5em;
    margin-top: .2em;
    border-radius: 50%;
    background-color: rgba(240, 248, 255, .32);
    position: absolute;
}

.fakeCircle1 {
    width: 3.5em;
    height: 3.5em;
    margin-top: 5em;
    border-radius: 50%;
    background-color: rgba(240, 248, 255, .32);
    position: absolute;
}

.fakeCircle2 {
    width: 3.5em;
    height: 3.5em;
    margin-top: 9.6em;
    border-radius: 50%;
    background-color: rgba(240, 248, 255, .32);
    position: absolute;
}

.fakeCircle3 {
    width: 3.5em;
    height: 3.5em;
    margin-top: 14.2em;
    border-radius: 50%;
    background-color: rgba(240, 248, 255, .32);
    position: absolute;
}

@media (max-width: 768px) {
    .showTag {
        display: none;
    }
}

.all {
    display: flex;
    flex-flow: column;
    position: absolute;
    right: 0;
    bottom: 15%;
    user-select: none;
    align-items: center;
    overflow: hidden;
    z-index: 200;
}


.showTag {
    justify-content: center
}

.showTag div {
    z-index: 201;
    position: absolute;
    padding: 0.3125em 0.625em;
    border-radius: 0.25em;
    white-space: nowrap;
    /* box-shadow: 0 0.125em 0.25em rgba(0, 0, 0, 0.2); */
    background-color: rgba(43, 40, 40, 0.7);
    text-align: center;
    transform: translateY(-50%);
}




.list {
    color: #ffffff;
    bottom: 24.5em;
    right: .6em;

    /* transform: translateY(-50%); */
}

.setting {
    color: #ffffff;
    bottom: 19.5em;
    right: 1.25em;

}

.chathistory {
    color: #ffffff;
    bottom: 15.5em;
    right: .6em;

}



.about {
    color: #ffffff;
    bottom: 10.2em;
    right: 1.25em;

}


.all .el-image {
    width: 4em;
    transition: transform 0.05s ease;
}

.all .el-image:hover {
    transform: scale(1.10);
}

.backImg {
    transition: transform 0.1s ease;
    /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
}

.backImg:hover {
    transform: scale(1.1);
    /* é¼ æ ‡æ‚¬æµ®æ—¶æ”¾å¤§ */
}

.fade-enter-active,
.fade-leave-active {
    transition: all 0.4s;
}

.fade-enter,
.fade-leave-to {
    opacity: 0;
    transform: translateY(0.625em);
}


.coverImg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 0.625em;
}

.main {
    width: 12.5em;
    margin-top: -1em;
    font-weight: normal;
}

.headTitle {
    font-size: 1.25em;
    color: #333;
}

.content {
    display: flex;
    flex-direction: column;
    font-size: 0.875em;
    margin-top: 1.25em;
    color: #999;
}


.music-item {
    border-radius: 0.375em;

}

.ScrollDiv {
    overflow-y: scroll;
    scrollbar-width: thin;
    scrollbar-color: #bac6cc #f2f3f2;
}

.music-item:hover {
    background-color: pink;
}

.highlight {
    background-color: #e6e6e6;
}

.active-border {
    border-bottom: 0.125em solid red;
}



button {
    background: #fbca1f;
    padding: 0.6em 1.3em;
    font-weight: 900;
    font-size: 1em;
    border: 3px solid black;
    border-radius: 0.4em;
    box-shadow: 0.1em 0.1em;
    cursor: pointer;
    margin-right: 2em;
    margin-left: 2em;
}

button:hover {
    transform: translate(-0.05em, -0.05em);
    box-shadow: 0.15em 0.15em;
}

button:active {
    transform: translate(0.05em, 0.05em);
    box-shadow: 0.05em 0.05em;
}

.message-container {
    padding: 10px;
    overflow-y: auto;
    height: 100%;
}

.message {
    padding: 10px;
    border-bottom: 1px solid #ddd;
}

.avatarBoxNick {
    position: relative;
    margin-top: -.5em;
    text-align: center;
    width: 4.2em;
    /* height: 2em; */
    color: #e2dede;
    font-size: 1.4em;
    background-color: rgba(88, 94, 87, .64);
    line-height: 1.1em;
    border-radius: 3px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}


.avatarSmall {
    background-color: rgba(0, 0, 0, .25);
}

.fade2-enter-active {
    transition: all 0.1s ease-out;
}

.fade2-leave-active {
    transition: all 0.05s cubic-bezier(1, 0.5, 0.8, 1);
}

.fade2-enter-from,
.fade2-leave-to {
    transform: translateX(20px);
    opacity: 0;
}
</style>
